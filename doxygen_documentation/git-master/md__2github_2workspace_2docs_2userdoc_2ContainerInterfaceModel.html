<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AutoPas</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="https://raw.githubusercontent.com/AutoPas/AutoPas/master/docs/graphics/AutoPasLogo_Small.svg">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript">
    function doOnLoad() {
        if (!window.location.href.startsWith("file://")) {
            // this is only done if we are on an actual webserver, where we expect to have ../autopas_onpageload.js
            var script = document.createElement('script');
            script.onload = function () {
                on_page_load();
            };
            script.src = "../onpageload.js";
            document.head.appendChild(script); //or something of the likes
        } else {
            var version_selector = document.getElementById("autopas_version_selector");
            var option = document.createElement("option");
            option.text = "local";
            option.value = "local";
            version_selector.appendChild(option);
        }
    }
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body onload="doOnLoad()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="main_selector">
    </div>
	<!--BEGIN VERSION INFO-->
	<div id="version_selector">
        <label for="autopas_version_selector">Version:</label>
        <select id="autopas_version_selector">
        </select>
	</div>
	<!--END VERSION INFO-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://autopas.github.io/"><img style="height: 56px;" alt="AutoPas" src="AutoPasLogo_Large.svg"/></a>
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
  </td>
     <td style="float:right"><div id="githublink"><a href="https://github.com/AutoPas/AutoPas"><img border="0" alt="GitHub" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" height="56px"></a></div></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Container Interface Model </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md16"></a> The behavior described in this section is completely hidden from AutoPas users. This was initially implemented in <a href="https://github.com/AutoPas/AutoPas/pull/642">PR 642</a>, so more details can be found there.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
External Black-Box Interface</h1>
<p>For an AutoPas user from the outside, it appears that the particle container is fully updated every time they call <code>AutoPas::updateContainer</code>. Particles leaving the domain are always returned, and particles can be added and deleted at any time. Historically this interface behavior was also called 'Linked-Cells-like'. For periodic boundary conditions or in an MPI-parallel simulation, the user is responsible for inserting the appropriate halo particles.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Static Rebuilding</h2>
<p>To ensure functionality, particles must not move more than <code>verletSkinPerTimestep / 2</code> per timestep. The particle neighbor lists are updated at a fixed rebuild frequency specified by the user. This works well with an appropriately chosen <code>skin</code>. A warning is shown when particles move faster than expected. User can additionally enable throwing exception when a particle is too fast by passing <code>fastParticleThrow</code> as <code>true</code> in the input file.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Dynamic Rebuilding</h2>
<p>The particle neighbor lists are updated when a particle moves more than <code>verletSkin / 2</code> or at the rebuild frequency. For this, every particle stores the position at which its neighbor list was rebuilt last in a member called <code>rAtRebuild</code>. This was implemented in the <a href="https://github.com/AutoPas/AutoPas/pull/821">PR 821</a>, so refer to it for more details.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Internal Container Behavior</h1>
<p>For Verlet list-based containers to perform efficiently, the aforementioned behavior is a problem, because they rely on their list references to not change until the next list rebuild. So our solution is to internally use a 'Verlet-like' behavior for all containers, where the actual container is not updated in every time step, leading to particles not necessarily being sorted into their new cells. We achieve this by avoiding container data structure changes during all updates that do not involve a potential rebuild of neighbor lists. This means that particles that would normally be deleted, like those leaving the domain or halos, are only marked for deletion (<code>OwnershipState::dummy</code>). They are only really removed during a container update at the end of a rebuild interval or container change.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
&lt;tt&gt;LogicHandler&lt;/tt&gt; Buffers</h2>
<p>The <code>LogicHandler</code> maintains particle buffers that allow the addition of particles to AutoPas without modifying the underlying container. These buffers are taken into account for the pairwise iteration as well as any other iterators. There is one pair of buffers for <code>owned</code> and <code>halo</code> particles per thread to allow parallel particle insertion.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Reinsert Halos</h2>
<p>As mentioned above, halo particles are not deleted immediately but only marked as <code>dummy</code>. Should the halo particle be reinserted before the container structure is updated, we search the vicinity of its coordinates. If there is a <code>dummy</code> particle with the same <code>id</code>, we replace it with the new particle. If nothing is found, the particle is added to a <code>LogicHandler</code> halo buffer. This effectively updates halo particles instead of deleting and reinserting them, making our data structures more stable.</p>
<h3><a class="anchor" id="autotoc_md23"></a>
Suboptimal Edge Cases</h3>
<p>It is still possible that there is a dummy that is not updated, and a new particle is added. Consider the following chain of events:</p><ul>
<li>The container is <code>LinkedCells</code> (or anything based on <code><a class="el" href="CellBlock3D_8h.html">CellBlock3D.h</a></code>), and a particle is stored in a cell just inside the boundary.</li>
<li>The particle's position changes to the halo region before a data structure update.</li>
<li>The particle is deleted (= turned <code>dummy</code>) by <code>AutoPas::updateContainer</code> because it left the domain.</li>
<li>The particle is immediately added as a halo again. Since halo particles are not allowed to exist in non-halo cells, the existing dummy is not updated, and a new halo particle is added to buffers.</li>
</ul>
<h1><a class="anchor" id="autotoc_md24"></a>
Related Files and Folders</h1>
<ul>
<li><a class="el" href="LeavingParticleCollector_8h.html">LeavingParticleCollector.h</a></li>
<li><a class="el" href="LogicHandler_8h.html">LogicHandler.h</a></li>
<li><a class="el" href="ParticleContainerInterface_8h.html">ParticleContainerInterface.h</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
