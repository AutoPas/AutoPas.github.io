<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AutoPas</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="https://raw.githubusercontent.com/AutoPas/AutoPas/master/docs/graphics/AutoPasLogo_Small.svg">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript">
    function doOnLoad() {
        if (!window.location.href.startsWith("file://")) {
            // this is only done if we are on an actual webserver, where we expect to have ../autopas_onpageload.js
            var script = document.createElement('script');
            script.onload = function () {
                on_page_load();
            };
            script.src = "../onpageload.js";
            document.head.appendChild(script); //or something of the likes
        } else {
            var version_selector = document.getElementById("autopas_version_selector");
            var option = document.createElement("option");
            option.text = "local";
            option.value = "local";
            version_selector.appendChild(option);
        }
    }
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body onload="doOnLoad()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="main_selector">
    </div>
	<!--BEGIN VERSION INFO-->
	<div id="version_selector">
        <label for="autopas_version_selector">Version:</label>
        <select id="autopas_version_selector">
        </select>
	</div>
	<!--END VERSION INFO-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://autopas.github.io/"><img style="height: 56px;" alt="AutoPas" src="AutoPasLogo_Large.svg"/></a>
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
  </td>
     <td style="float:right"><div id="githublink"><a href="https://github.com/AutoPas/AutoPas"><img border="0" alt="GitHub" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" height="56px"></a></div></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Simulation Loop </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md59"></a>This page describes the assumptions AutoPas makes about how particle simulations look and how AutoPas fits into them.</p>
<h1><a class="anchor" id="autotoc_md60"></a>
High-Level View</h1>
<p>AutoPas assumes that any (short-range) particle simulation boils down to three high-level steps:</p><ol type="1">
<li>Particle movement</li>
<li>Particle interaction</li>
<li>Measurements</li>
</ol>
<h1><a class="anchor" id="autotoc_md61"></a>
Code Example</h1>
<p>A conceptual example of a primary simulation loop: </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="comment">// main simulation loop</span></div>
<div class="line"><span class="keywordflow">while</span> (needsMoreIterations()) {</div>
<div class="line">   <span class="comment">// 1. Particles movement as a result of interactions or simulation forces.</span></div>
<div class="line">   updatePositions();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// 1.1 Data structure update</span></div>
<div class="line">   <span class="comment">// Due to AutoPas-external alteration of the particles, AutoPas-internal data structures have to be updated.</span></div>
<div class="line">   <span class="keyword">auto</span> emigrants = <a class="code hl_namespace" href="namespaceautopas.html">autopas</a>-&gt;updateContainer(); <span class="comment">// deletes halo particles, returns particles that are now outside the container</span></div>
<div class="line"> </div>
<div class="line">   <span class="comment">// 1.2 Particle exchange</span></div>
<div class="line">   <span class="keyword">auto</span> [immigrants, haloParticles] = applyBoundaryConditions(emigrants); <span class="comment">// user code. Potentially exchanges particles via MPI</span></div>
<div class="line">   <a class="code hl_namespace" href="namespaceautopas.html">autopas</a>-&gt;addParticles(immigrants);           <span class="comment">// particles that go into the container</span></div>
<div class="line">   <a class="code hl_namespace" href="namespaceautopas.html">autopas</a>-&gt;addHaloParticles(haloParticles);    <span class="comment">// particles that are so close to the container that they have an influence</span></div>
<div class="line">                                                <span class="comment">// on particles inside (periodic boundaries, MPI rank interfaces, ...)</span></div>
<div class="line"> </div>
<div class="line">   <span class="comment">// 2. Particle Interactions</span></div>
<div class="line">   YourFunctor functor();                       <span class="comment">// User code</span></div>
<div class="line">   <a class="code hl_namespace" href="namespaceautopas.html">autopas</a>-&gt;computeInteractions(&amp;functor);      <span class="comment">// Tuning and parallelization happen here</span></div>
<div class="line"> </div>
<div class="line">   <span class="comment">// 3. Your science goes here.</span></div>
<div class="line">}</div>
<div class="ttc" id="anamespaceautopas_html"><div class="ttname"><a href="namespaceautopas.html">autopas</a></div><div class="ttdoc">This is the main namespace of AutoPas.</div><div class="ttdef"><b>Definition:</b> AutoPasDecl.h:31</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md62"></a>
Steps</h1>
<h2><a class="anchor" id="autotoc_md63"></a>
1. Particle Movement</h2>
<p>This step is highly user-dependent. Based on the simulation at hand, particles move due to the result of interaction forces or forces coming from the simulation model. Nevertheless, positions are usually updated through regular AutoPas iterators (see <a href="https://github.com/AutoPas/AutoPas/blob/master/docs/userdoc/Iterators.md"><code>Iterators.md</code></a> for details): </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span> updatePositions() {</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;p : <a class="code hl_namespace" href="namespaceautopas.html">autopas</a>) {</div>
<div class="line">      p.setR(calculateNewPosition(p);</div>
<div class="line">   }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md64"></a>
1.1 Data Structure Update</h3>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">auto</span> emigrants = <a class="code hl_namespace" href="namespaceautopas.html">autopas</a>-&gt;updateContainer();</div>
</div><!-- fragment --><p> This method has to be called in every iteration after particles are moved. It achieves three things (see <a href="https://github.com/AutoPas/AutoPas/blob/master/docs/userdoc/ContainerInterfaceModel.md"><code>ContainerInterfaceModel.md</code></a> for more details):</p><ul>
<li>Internal data structures are updated if necessary.</li>
<li>Halo particles are (marked as) deleted.</li>
<li>Particles leaving the bounding box of the container are (marked as) deleted and returned as emigrants.</li>
</ul>
<h3><a class="anchor" id="autotoc_md65"></a>
1.2 Particle Exchange</h3>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><a class="code hl_namespace" href="namespaceautopas.html">autopas</a>-&gt;addParticles(immigrants);</div>
<div class="line"><a class="code hl_namespace" href="namespaceautopas.html">autopas</a>-&gt;addHaloParticles(haloParticles);</div>
</div><!-- fragment --><p> Depending on the simulation, the user might want to remove and/or insert particles in the local simulation. Examples of this could be:</p><ul>
<li>Particles crossing periodic boundaries (remove in old subdomain, insert in new one).</li>
<li>Particles moving from one MPI rank to another.</li>
<li>Insertion of particles due to breakup events.</li>
<li>Deletion of particles due to outflow condition.</li>
</ul>
<h2><a class="anchor" id="autotoc_md66"></a>
2. Particle Interaction</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line">YourFunctor functor();</div>
<div class="line"><a class="code hl_namespace" href="namespaceautopas.html">autopas</a>-&gt;computeInteractions(&amp;functor);</div>
</div><!-- fragment --><p> Apply your custom force interaction via one or several functors. This step triggers the tuning. It internally applies OpenMP parallelization, so do not use it in other thread-parallel environments.</p>
<h2><a class="anchor" id="autotoc_md67"></a>
3. Measurements</h2>
<p>This part encompasses everything else, like sampling particle data, computing macroscopic properties, statistical analysis, ... For performance reasons, it might be advisable to not do any pairwise particle measurements here, like, for example, pairwise distances for a radial distribution function. Such <code>O(N^2)</code> operations are better handled within or as a separate functor in step 2.</p>
<h1><a class="anchor" id="autotoc_md68"></a>
Related Files and Folders</h1>
<ul>
<li><a class="el" href="AutoPasDecl_8h.html">AutoPasDecl.h</a></li>
<li>Simulation.cpp </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
